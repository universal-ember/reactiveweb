{"version":3,"file":"fps.js","sources":["../src/fps.ts"],"sourcesContent":["import { cell, resource, resourceFactory } from 'ember-resources';\n\n/**\n * Utility that uses requestAnimationFrame to report\n * how many frames per second the current monitor is\n * rendering at.\n *\n * The result is rounded to two decimal places.\n *\n * ```js\n * import { FrameRate } from 'reactiveweb/fps';\n *\n * <template>\n *   {{FrameRate}}\n * </template>\n * ```\n */\nexport const FrameRate = resource(({ on }) => {\n  const value = cell(0);\n  const startTime = new Date().getTime();\n  let frame: number;\n\n  const update = () => {\n    // simulate receiving data as fast as possible\n    frame = requestAnimationFrame(() => {\n      value.current++;\n      update();\n    });\n  };\n\n  on.cleanup(() => cancelAnimationFrame(frame));\n\n  // Start the infinite requestAnimationFrame chain\n  update();\n\n  return () => {\n    const elapsed = (new Date().getTime() - startTime) * 0.001;\n    const fps = value.current * Math.pow(elapsed, -1);\n    const rounded = Math.round(fps * 100) * 0.01;\n    // account for https://stackoverflow.com/a/588014/356849\n    const formatted = `${rounded}`.substring(0, 5);\n\n    return formatted;\n  };\n});\n\n/**\n * Utility that will report the frequency of updates to tracked data.\n *\n * ```js\n * import { UpdateFrequency } from 'reactiveweb/fps';\n *\n * export default class Demo extends Component {\n *   @tracked someProp;\n *\n *   @use updateFrequency = UpdateFrequency(() => this.someProp);\n *\n *   <template>\n *     {{this.updateFrequency}}\n *   </template>\n * }\n * ```\n *\n * NOTE: the function passed to UpdateFrequency may not set tracked data.\n */\nexport const UpdateFrequency = resourceFactory((ofWhat: () => unknown, updateInterval = 500) => {\n  updateInterval ||= 500;\n\n  const multiplier = 1000 / updateInterval;\n  let framesSinceUpdate = 0;\n\n  return resource(({ on }) => {\n    const value = cell(0);\n    const interval = setInterval(() => {\n      value.current = framesSinceUpdate * multiplier;\n      framesSinceUpdate = 0;\n    }, updateInterval);\n\n    on.cleanup(() => clearInterval(interval));\n\n    return () => {\n      ofWhat();\n      framesSinceUpdate++;\n\n      return value.current;\n    };\n  });\n});\n"],"names":["FrameRate","resource","on","value","cell","startTime","Date","getTime","frame","update","requestAnimationFrame","current","cleanup","cancelAnimationFrame","elapsed","fps","Math","pow","rounded","round","formatted","substring","UpdateFrequency","resourceFactory","ofWhat","updateInterval","multiplier","framesSinceUpdate","interval","setInterval","clearInterval"],"mappings":";;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMA,SAAS,GAAGC,QAAQ,CAAC,CAAC;AAAEC,EAAAA;AAAG,CAAC,KAAK;AAC5C,EAAA,MAAMC,KAAK,GAAGC,IAAI,CAAC,CAAC,CAAC;EACrB,MAAMC,SAAS,GAAG,IAAIC,IAAI,EAAE,CAACC,OAAO,EAAE;AACtC,EAAA,IAAIC,KAAa;EAEjB,MAAMC,MAAM,GAAGA,MAAM;AACnB;IACAD,KAAK,GAAGE,qBAAqB,CAAC,MAAM;MAClCP,KAAK,CAACQ,OAAO,EAAE;AACfF,MAAAA,MAAM,EAAE;AACV,IAAA,CAAC,CAAC;EACJ,CAAC;EAEDP,EAAE,CAACU,OAAO,CAAC,MAAMC,oBAAoB,CAACL,KAAK,CAAC,CAAC;;AAE7C;AACAC,EAAAA,MAAM,EAAE;AAER,EAAA,OAAO,MAAM;AACX,IAAA,MAAMK,OAAO,GAAG,CAAC,IAAIR,IAAI,EAAE,CAACC,OAAO,EAAE,GAAGF,SAAS,IAAI,KAAK;AAC1D,IAAA,MAAMU,GAAG,GAAGZ,KAAK,CAACQ,OAAO,GAAGK,IAAI,CAACC,GAAG,CAACH,OAAO,EAAE,EAAE,CAAC;IACjD,MAAMI,OAAO,GAAGF,IAAI,CAACG,KAAK,CAACJ,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI;AAC5C;IACA,MAAMK,SAAS,GAAG,CAAA,EAAGF,OAAO,CAAA,CAAE,CAACG,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;AAE9C,IAAA,OAAOD,SAAS;EAClB,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAME,eAAe,GAAGC,eAAe,CAAC,CAACC,MAAqB,EAAEC,cAAc,GAAG,GAAG,KAAK;AAC9FA,EAAAA,cAAc,KAAK,GAAG;AAEtB,EAAA,MAAMC,UAAU,GAAG,IAAI,GAAGD,cAAc;EACxC,IAAIE,iBAAiB,GAAG,CAAC;EAEzB,OAAO1B,QAAQ,CAAC,CAAC;AAAEC,IAAAA;AAAG,GAAC,KAAK;AAC1B,IAAA,MAAMC,KAAK,GAAGC,IAAI,CAAC,CAAC,CAAC;AACrB,IAAA,MAAMwB,QAAQ,GAAGC,WAAW,CAAC,MAAM;AACjC1B,MAAAA,KAAK,CAACQ,OAAO,GAAGgB,iBAAiB,GAAGD,UAAU;AAC9CC,MAAAA,iBAAiB,GAAG,CAAC;IACvB,CAAC,EAAEF,cAAc,CAAC;IAElBvB,EAAE,CAACU,OAAO,CAAC,MAAMkB,aAAa,CAACF,QAAQ,CAAC,CAAC;AAEzC,IAAA,OAAO,MAAM;AACXJ,MAAAA,MAAM,EAAE;AACRG,MAAAA,iBAAiB,EAAE;MAEnB,OAAOxB,KAAK,CAACQ,OAAO;IACtB,CAAC;AACH,EAAA,CAAC,CAAC;AACJ,CAAC;;;;"}